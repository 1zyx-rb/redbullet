-- THE ESP IS STILL BEING UPDATED AND PROGRAMMED, IT MAY BREAK

-- LocalScript

-- Function to reset the highlight on a character
local function resetHighlight(character)
    for _, part in ipairs(character:GetChildren()) do
        if part:IsA("BasePart") and part:FindFirstChild("OriginalColor") then
            part.Color = part.OriginalColor.Value -- Reset to original color
            part.Material = Enum.Material.Plastic -- Reset to original material
        end
    end

    local head = character:FindFirstChild("Head")
    if head then
        local billboardGui = head:FindFirstChildOfClass("BillboardGui")
        if billboardGui then
            local nameLabel = billboardGui:FindFirstChildOfClass("TextLabel")
            if nameLabel then
                nameLabel.TextColor3 = Color3.new(1, 1, 1) -- Reset to white color
            end
        end
    end
end

-- Function to highlight a character
local function highlightCharacter(character)
    for _, part in ipairs(character:GetChildren()) do
        if part:IsA("BasePart") then
            if not part:FindFirstChild("OriginalColor") then
                local originalColor = Instance.new("Color3Value")
                originalColor.Name = "OriginalColor"
                originalColor.Value = part.Color
                originalColor.Parent = part
            end
            part.Color = Color3.new(0, 0, 1) -- Blue color
            part.Material = Enum.Material.ForceField
        end
    end

    local head = character:FindFirstChild("Head")
    if head then
        local billboardGui = head:FindFirstChildOfClass("BillboardGui")
        if billboardGui then
            local nameLabel = billboardGui:FindFirstChildOfClass("TextLabel")
            if nameLabel then
                nameLabel.TextColor3 = Color3.new(1, 0, 0) -- Red color
            end
        end
    end
end

-- Function to handle the continuous cycle
local function startCycle(character)
    coroutine.wrap(function()
        while character.Parent do
            highlightCharacter(character)
            wait(1.5)
            resetHighlight(character)
            print("Completed cycle!")
        end
    end)()
end

-- Event listener for new players
local function onPlayerAdded(player)
    player.CharacterAdded:Connect(function(character)
        startCycle(character)
    end)
end

-- Connect the PlayerAdded event
game.Players.PlayerAdded:Connect(onPlayerAdded)

-- Start cycle for already present players
for _, player in ipairs(game.Players:GetPlayers()) do
    if player.Character then
        startCycle(player.Character)
    end
end
